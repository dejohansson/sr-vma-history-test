<!DOCTYPE html>
<html>
  <head>
    <title>SR VMA Alerts</title>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
    <meta content="utf-8" http-equiv="encoding" />
    <link
      rel="icon"
      href="data:image/svg+xml,%20%20%20%20%3Csvg%20viewBox%3D%220%200%20128%20128%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%20aria-hidden%3D%22true%22%20role%3D%22img%22%20class%3D%22iconify%20iconify--noto%22%20preserveAspectRatio%3D%22xMidYMid%20meet%22%20fill%3D%22%23000000%22%3E%3Cg%20id%3D%22SVGRepo_bgCarrier%22%20stroke-width%3D%220%22%3E%3C%2Fg%3E%3Cg%20id%3D%22SVGRepo_tracerCarrier%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3C%2Fg%3E%3Cg%20id%3D%22SVGRepo_iconCarrier%22%3E%3Cpath%20d%3D%22M41.01%20114.68L30.84%2083.46l15.02.89l.74%208.78c.92%201.73%203.09%202.52%204.01%204.25c.47.89.55%201.94.42%202.94c-.27%202.07-1.36%204.31-.3%206.12c1.25%202.13%204.37%202.74%204.27%205.67c-.1%202.68-12.69%206.32-13.99%202.57z%22%20fill%3D%22%23c62828%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M39.49%20121.41l-.95.33a7.179%207.179%200%200%201-9.14-4.43L17.6%2083.28h16.26c.58%201.66.78%202.27%201.37%203.93c.54%201.51%201.28%202.26.8%203.86c-.48%201.58-.88%203.38-.06%204.92c.92%201.73%203.09%202.52%204.01%204.25c.47.89.55%201.94.42%202.94c-.27%202.07-1.36%204.31-.3%206.12c1.25%202.13%204.37%202.74%204.27%205.67c-.09%202.68-2.36%205.57-4.88%206.44z%22%20fill%3D%22%23f44336%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M39.78%20106.18c-.38%201.56.55%201.77%201.49%201.79c2.29.06%205.31-.86%206.8-1.53c.57-.25%201.1-.58%201.58-.95c.36-.28.6-.69.63-1.14c.07-1.31.57-2.7.74-4.03c.07-.55.07-1.12-.02-1.66c-.07-.43-.57-.65-.95-.44c-.96.53-2.67%201.41-3.81%201.64c-2.26.46-3.65.42-4.63.44c-.73.01-1.31.66-1.21%201.38c.07.5.06%201.01%200%201.5c-.13.98-.38%202.01-.62%203z%22%20fill%3D%22%23a12524%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M44.37%20114.96c-1.34%204.26-4.68%205.74-8.17%205.97c-3.38.23-5.72-1.66-5.72-1.66c4.84%207.28%2017.26%202.75%2019.78%201.37c3.85-2.11%204.49-4.25%204.74-8.28c.02-.25-.4-1.1-1.19-.46c-1.2.96-2.56%201.31-4.08%201.62c-1.87.38-2.87.27-3.63.32c-.98.06-1.47.28-1.73%201.12z%22%20fill%3D%22%23a12524%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M17.6%2083.28l3.13%209.08s1.91-4.25%209.51-3.47c5.15.53%206.69%202.33%206.69%202.33l.33-7.68l-19.66-.26z%22%20fill%3D%22%23c62828%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M103.16%20110.64S69.35%2085.61%2041.24%2084.86c-12.09-.32-20.86-.35-22.97-.35C11.65%2084.52%204%2075.11%204%2058.55s8.61-27.73%2015.23-27.73c.98%200%2011.45.62%2024.11.26c29.78-.84%2059.82-24.62%2059.82-24.62v104.18z%22%20fill%3D%22%23e0e0e0%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M80.14%2073.46c-1.13%202.02-1.15%206.62-.85%2010.88c.22%203.05-2.83%205.31-5.68%204.19c-19.44-7.58-35.4-6.9-35.4-6.9l.77%203.17l2.25.06c16.98.45%2036.04%209.76%2048.47%2017.07c0%200-3.84-5.52-5.8-13.06c-2.03-7.86-3.76-15.41-3.76-15.41z%22%20fill%3D%22%23bdbdbd%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M34.27%2058.55c0-9.45%203.09-20.05%206.96-27.42c-11.69.24-21.07-.31-22-.31C12.61%2030.82%204%2041.99%204%2058.55s7.65%2025.96%2014.28%2025.96c2.11%200%2010.88.03%2022.97.35c.07%200%20.15.01.22.01c-4.48-8.04-7.2-16.9-7.2-26.32z%22%20fill%3D%22%23f44336%22%3E%3C%2Fpath%3E%3Cellipse%20cx%3D%22103.16%22%20cy%3D%2258.55%22%20rx%3D%2220.84%22%20ry%3D%2252.09%22%20fill%3D%22%232f7889%22%3E%3C%2Fellipse%3E%3ClinearGradient%20id%3D%22IconifyId17ecdb2904d178eab9944%22%20gradientUnits%3D%22userSpaceOnUse%22%20x1%3D%22103.164%22%20y1%3D%22103.827%22%20x2%3D%22103.164%22%20y2%3D%2245.222%22%3E%3Cstop%20offset%3D%220%22%20stop-color%3D%22%23353738%22%3E%3C%2Fstop%3E%3Cstop%20offset%3D%221%22%20stop-color%3D%22%23353738%22%20stop-opacity%3D%220%22%3E%3C%2Fstop%3E%3C%2FlinearGradient%3E%3Cpath%20d%3D%22M83.24%2043.31c-.59%204.82-.91%209.94-.91%2015.25c0%2028.77%209.33%2052.09%2020.84%2052.09s20.84-23.32%2020.84-52.09c0-5.31-.32-10.42-.91-15.25H83.24z%22%20fill%3D%22url%28%23IconifyId17ecdb2904d178eab9944%29%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M103.16%20113.64c-13.59%200-23.84-23.68-23.84-55.09c0-31.41%2010.25-55.09%2023.84-55.09S124%2027.15%20124%2058.55c0%2031.41-7.25%2055.09-20.84%2055.09zm0-104.18c-8.44%200-17.84%2020.16-17.84%2049.09s9.4%2049.09%2017.84%2049.09S121%2087.48%20121%2058.55s-9.4-49.09-17.84-49.09z%22%20fill%3D%22%23e0e0e0%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M89.56%2023.24c-.9%202.44-4.15%207.85-5.65%2025.65c-.05.6-.38%203.24-1.85%203.24c-.98%200-1.27-1.48-1.27-3.52c0-7.95%201.32-16.72%204.39-25.38c1.74-4.89%205.63-3.35%204.38.01z%22%20fill%3D%22%23ffffff%22%3E%3C%2Fpath%3E%3CradialGradient%20id%3D%22IconifyId17ecdb2904d178eab9945%22%20cx%3D%22101.207%22%20cy%3D%2260.248%22%20r%3D%2220.918%22%20gradientTransform%3D%22matrix%281%200%200%201.7015%200%20-42.264%29%22%20gradientUnits%3D%22userSpaceOnUse%22%3E%3Cstop%20offset%3D%22.416%22%20stop-color%3D%22%2382aec0%22%3E%3C%2Fstop%3E%3Cstop%20offset%3D%221%22%20stop-color%3D%22%237fa9bb%22%20stop-opacity%3D%220%22%3E%3C%2Fstop%3E%3C%2FradialGradient%3E%3Cpath%20d%3D%22M85.9%2046.49l18.9%202.2v19.9l-18.76%203.38c-1.24-15.73-.14-25.48-.14-25.48z%22%20fill%3D%22url%28%23IconifyId17ecdb2904d178eab9945%29%22%3E%3C%2Fpath%3E%3Cellipse%20cx%3D%22104.8%22%20cy%3D%2258.65%22%20rx%3D%224.72%22%20ry%3D%229.95%22%20fill%3D%22%23e0e0e0%22%3E%3C%2Fellipse%3E%3Cpath%20d%3D%22M38.23%2087.4l-.75%201.3l3.21%206.27c.39.76%201.23%201.18%202.07%201.02l5.42-1.09s1.51-2.15%201.8-2.64c.29-.49.18-.78.18-.78L44%2092.66c-.01%200-5.57-5.2-5.77-5.26z%22%20fill%3D%22%23353738%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M42.33%2091.96l-4.16-4.53l7.49-.03l4.24%203.67c.51.54.18%201.21-.55%201.33l-4.21.66c-1.06.16-2.13-.25-2.81-1.1z%22%20fill%3D%22%23616161%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M57.51%2037.53c6.34-.84%2012.6-2.77%2017.96-6.26c-3.11%208.35-4.59%2018.41-3.44%2027.26c-2.96-1.46-5.95-2.92-9.11-3.86c-2.64-.78-5.37-1.19-8.1-1.51c-6.87-.83-13.23-.96-20.14-.83c.2%200%20.75-4.67%201.59-8.15c.84-3.48%201.7-5.5%201.7-5.5s13.53-.35%2019.54-1.15z%22%20fill%3D%22%23ffffff%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M35.28%2038.25c-9.7.29-20.53.42-20.53.42s-4.89%204.26-5.76%2013.65c0%200%2011.55%200%2022.04.19c.74-6.76%202.92-11.75%204.25-14.26z%22%20fill%3D%22%23ff7555%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3C%2Fsvg%3E%0A"
    />
    <script
      type="text/javascript"
      src="https://unpkg.com/vis-timeline@8.4.0/standalone/umd/vis-timeline-graph2d.min.js"
    ></script>
    <style>
      :root {
        --header-height: 180px;
      }

      body {
        background-color: #202328;
        font-family: Arial, sans-serif;
        margin: 20px;
        height: 100vh;
        overflow: hidden;
      }

      #timeline {
        width: 100%;
        height: calc(100vh - var(--header-height));
        border: none;
        background-color: #212429;
        overflow: hidden;
      }

      .vis-timeline {
        border: none;
        background-color: #212429;
      }

      .vis-time-axis .vis-text {
        color: #c5d1e6;
        font-weight: 500;
      }

      .vis-time-axis .vis-grid.vis-minor {
        border-color: #2d2f35;
      }

      .vis-time-axis .vis-grid.vis-major {
        border-color: #52555a;
      }

      .vis-item {
        background-color: #98a7c3;
        border-color: #98a7c3;
        color: #1a1c20;
        font-weight: 600;
        font-size: 24px;
      }

      .vis-item a {
        color: inherit;
        text-decoration: none;
      }

      .vis-item a:hover {
        color: inherit;
        text-decoration: none;
      }

      .vis-item a:visited {
        color: inherit;
      }

      .vis-item.alert-item {
        background-color: #e61f43;
        border-color: #c12745;
        color: #ffffff;
      }

      .vis-panel {
        background-color: #212429;
      }

      .vis-labelset .vis-label {
        color: #c5d1e6;
        border-color: #2d2f35;
        font-weight: 500;
      }

      .vis-current-time {
        background-color: #4a9eff;
        width: 3px;
      }

      .vis-tooltip {
        background-color: #2d2f35 !important;
        color: #c5d1e6 !important;
        border: 1px solid #52555a !important;
        border-radius: 4px !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4) !important;
        font-family: Arial, sans-serif !important;
        padding: 8px 12px !important;
      }

      #latest-update-link {
        transition: all 0.3s ease;
      }

      @media (max-height: 600px) {
        :root {
          --header-height: 70px;
        }

        body {
          margin: 2px;
        }

        #latest-update-link {
          margin-bottom: 2px !important;
          padding: 8px 8px !important;
        }

        #latest-update h2 {
          display: none;
        }

        #update-content {
          gap: 6px !important;
        }

        #update-content > div {
          display: flex;
          align-items: center;
          gap: 6px;
        }

        #update-emoji,
        #update-emoji span {
          font-size: 20px !important;
        }

        #update-type {
          font-size: 20px !important;
          margin-bottom: 0 !important;
        }

        #update-time {
          font-size: 16px !important;
        }
      }
    </style>
  </head>

  <body>
    <a
      id="latest-update-link"
      href=""
      target="_blank"
      style="
        display: block;
        margin-bottom: 20px;
        padding: 20px;
        border: 1px solid #2d2f35;
        background-color: #212429;
        border-radius: 8px;
        text-decoration: none;
        color: inherit;
      "
    >
      <div id="latest-update">
        <h2 style="margin: 0 0 15px 0; color: #c5d1e6; font-size: 28px">
          Latest VMA Update
        </h2>
        <div
          id="update-content"
          style="display: flex; align-items: center; gap: 15px"
        >
          <span id="update-emoji" style="font-size: 48px"></span>
          <div>
            <div
              id="update-type"
              style="font-size: 24px; font-weight: 600; margin-bottom: 5px"
            ></div>
            <div id="update-time" style="font-size: 16px; color: #c5d1e6"></div>
          </div>
        </div>
      </div>
    </a>

    <div id="timeline"></div>

    <script type="module">
      import { vmaData } from "./data.js?v=VERSION_PLACEHOLDER";

      const REPO_URL =
        "https://github.com/dejohansson/sr-vma-history-test/blob/main/data/vma";

      const sleepingEmoji = "ðŸ˜´";
      const loudspeakerSvg =
        '<svg viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--noto" preserveAspectRatio="xMidYMid meet" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M41.01 114.68L30.84 83.46l15.02.89l.74 8.78c.92 1.73 3.09 2.52 4.01 4.25c.47.89.55 1.94.42 2.94c-.27 2.07-1.36 4.31-.3 6.12c1.25 2.13 4.37 2.74 4.27 5.67c-.1 2.68-12.69 6.32-13.99 2.57z" fill="#c62828"></path><path d="M39.49 121.41l-.95.33a7.179 7.179 0 0 1-9.14-4.43L17.6 83.28h16.26c.58 1.66.78 2.27 1.37 3.93c.54 1.51 1.28 2.26.8 3.86c-.48 1.58-.88 3.38-.06 4.92c.92 1.73 3.09 2.52 4.01 4.25c.47.89.55 1.94.42 2.94c-.27 2.07-1.36 4.31-.3 6.12c1.25 2.13 4.37 2.74 4.27 5.67c-.09 2.68-2.36 5.57-4.88 6.44z" fill="#f44336"></path><path d="M39.78 106.18c-.38 1.56.55 1.77 1.49 1.79c2.29.06 5.31-.86 6.8-1.53c.57-.25 1.1-.58 1.58-.95c.36-.28.6-.69.63-1.14c.07-1.31.57-2.7.74-4.03c.07-.55.07-1.12-.02-1.66c-.07-.43-.57-.65-.95-.44c-.96.53-2.67 1.41-3.81 1.64c-2.26.46-3.65.42-4.63.44c-.73.01-1.31.66-1.21 1.38c.07.5.06 1.01 0 1.5c-.13.98-.38 2.01-.62 3z" fill="#a12524"></path><path d="M44.37 114.96c-1.34 4.26-4.68 5.74-8.17 5.97c-3.38.23-5.72-1.66-5.72-1.66c4.84 7.28 17.26 2.75 19.78 1.37c3.85-2.11 4.49-4.25 4.74-8.28c.02-.25-.4-1.1-1.19-.46c-1.2.96-2.56 1.31-4.08 1.62c-1.87.38-2.87.27-3.63.32c-.98.06-1.47.28-1.73 1.12z" fill="#a12524"></path><path d="M17.6 83.28l3.13 9.08s1.91-4.25 9.51-3.47c5.15.53 6.69 2.33 6.69 2.33l.33-7.68l-19.66-.26z" fill="#c62828"></path><path d="M103.16 110.64S69.35 85.61 41.24 84.86c-12.09-.32-20.86-.35-22.97-.35C11.65 84.52 4 75.11 4 58.55s8.61-27.73 15.23-27.73c.98 0 11.45.62 24.11.26c29.78-.84 59.82-24.62 59.82-24.62v104.18z" fill="#e0e0e0"></path><path d="M80.14 73.46c-1.13 2.02-1.15 6.62-.85 10.88c.22 3.05-2.83 5.31-5.68 4.19c-19.44-7.58-35.4-6.9-35.4-6.9l.77 3.17l2.25.06c16.98.45 36.04 9.76 48.47 17.07c0 0-3.84-5.52-5.8-13.06c-2.03-7.86-3.76-15.41-3.76-15.41z" fill="#bdbdbd"></path><path d="M34.27 58.55c0-9.45 3.09-20.05 6.96-27.42c-11.69.24-21.07-.31-22-.31C12.61 30.82 4 41.99 4 58.55s7.65 25.96 14.28 25.96c2.11 0 10.88.03 22.97.35c.07 0 .15.01.22.01c-4.48-8.04-7.2-16.9-7.2-26.32z" fill="#f44336"></path><ellipse cx="103.16" cy="58.55" rx="20.84" ry="52.09" fill="#2f7889"></ellipse><linearGradient id="IconifyId17ecdb2904d178eab9944" gradientUnits="userSpaceOnUse" x1="103.164" y1="103.827" x2="103.164" y2="45.222"><stop offset="0" stop-color="#353738"></stop><stop offset="1" stop-color="#353738" stop-opacity="0"></stop></linearGradient><path d="M83.24 43.31c-.59 4.82-.91 9.94-.91 15.25c0 28.77 9.33 52.09 20.84 52.09s20.84-23.32 20.84-52.09c0-5.31-.32-10.42-.91-15.25H83.24z" fill="url(#IconifyId17ecdb2904d178eab9944)"></path><path d="M103.16 113.64c-13.59 0-23.84-23.68-23.84-55.09c0-31.41 10.25-55.09 23.84-55.09S124 27.15 124 58.55c0 31.41-7.25 55.09-20.84 55.09zm0-104.18c-8.44 0-17.84 20.16-17.84 49.09s9.4 49.09 17.84 49.09S121 87.48 121 58.55s-9.4-49.09-17.84-49.09z" fill="#e0e0e0"></path><path d="M89.56 23.24c-.9 2.44-4.15 7.85-5.65 25.65c-.05.6-.38 3.24-1.85 3.24c-.98 0-1.27-1.48-1.27-3.52c0-7.95 1.32-16.72 4.39-25.38c1.74-4.89 5.63-3.35 4.38.01z" fill="#ffffff"></path><radialGradient id="IconifyId17ecdb2904d178eab9945" cx="101.207" cy="60.248" r="20.918" gradientTransform="matrix(1 0 0 1.7015 0 -42.264)" gradientUnits="userSpaceOnUse"><stop offset=".416" stop-color="#82aec0"></stop><stop offset="1" stop-color="#7fa9bb" stop-opacity="0"></stop></radialGradient><path d="M85.9 46.49l18.9 2.2v19.9l-18.76 3.38c-1.24-15.73-.14-25.48-.14-25.48z" fill="url(#IconifyId17ecdb2904d178eab9945)"></path><ellipse cx="104.8" cy="58.65" rx="4.72" ry="9.95" fill="#e0e0e0"></ellipse><path d="M38.23 87.4l-.75 1.3l3.21 6.27c.39.76 1.23 1.18 2.07 1.02l5.42-1.09s1.51-2.15 1.8-2.64c.29-.49.18-.78.18-.78L44 92.66c-.01 0-5.57-5.2-5.77-5.26z" fill="#353738"></path><path d="M42.33 91.96l-4.16-4.53l7.49-.03l4.24 3.67c.51.54.18 1.21-.55 1.33l-4.21.66c-1.06.16-2.13-.25-2.81-1.1z" fill="#616161"></path><path d="M57.51 37.53c6.34-.84 12.6-2.77 17.96-6.26c-3.11 8.35-4.59 18.41-3.44 27.26c-2.96-1.46-5.95-2.92-9.11-3.86c-2.64-.78-5.37-1.19-8.1-1.51c-6.87-.83-13.23-.96-20.14-.83c.2 0 .75-4.67 1.59-8.15c.84-3.48 1.7-5.5 1.7-5.5s13.53-.35 19.54-1.15z" fill="#ffffff"></path><path d="M35.28 38.25c-9.7.29-20.53.42-20.53.42s-4.89 4.26-5.76 13.65c0 0 11.55 0 22.04.19c.74-6.76 2.92-11.75 4.25-14.26z" fill="#ff7555"></path></g></svg>';

      function debounce(func, wait) {
        let timeout;
        return function (...args) {
          clearTimeout(timeout);
          timeout = setTimeout(() => func.apply(this, args), wait);
        };
      }

      var items = new vis.DataSet(
        vmaData.map((item, index) => {
          const fileName = `${item.datetime}_${item.type}.json`;
          const githubUrl = `${REPO_URL}/${fileName}`;
          return {
            id: index + 1,
            itemType: item.type,
            githubUrl: githubUrl,
            start: item.datetime,
            className: item.type === "alert" ? "alert-item" : "",
          };
        })
      );

      const currentDate = new Date();

      // Configuration for the Timeline
      var options = {
        template: function (item, element) {
          // For clusters
          if (item.isCluster) {
            const container = document.createElement("span");
            container.style.display = "flex";
            container.style.alignItems = "center";
            container.style.gap = "8px";

            const iconSpan = document.createElement("span");
            iconSpan.style.fontSize = "24px";
            iconSpan.textContent = sleepingEmoji;
            container.appendChild(iconSpan);

            const countSpan = document.createElement("span");
            const count = item.items.length;
            countSpan.textContent = `${count} Quiet`;
            container.appendChild(countSpan);

            return container;
          }

          // For individual items
          const container = document.createElement("span");
          container.style.display = "flex";
          container.style.alignItems = "center";
          container.style.gap = "8px";

          if (item.itemType === "quiet") {
            const iconSpan = document.createElement("span");
            iconSpan.style.fontSize = "24px";
            iconSpan.textContent = sleepingEmoji;
            container.appendChild(iconSpan);
          } else {
            const tempDiv = document.createElement("div");
            tempDiv.innerHTML = loudspeakerSvg
              .replace('fill="#000000"', 'width="24" height="24"')
              .replace(
                "<svg",
                '<svg style="display: inline-block; vertical-align: middle;"'
              );
            container.appendChild(tempDiv.firstChild);
          }

          const labelSpan = document.createElement("span");
          labelSpan.textContent = item.itemType === "quiet" ? "Quiet" : "Alert";
          container.appendChild(labelSpan);

          const link = document.createElement("a");
          link.href = item.githubUrl;
          link.target = "_blank";
          link.rel = "noopener noreferrer";
          link.title = new Date(item.start).toLocaleString("en-SE", {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric",
            hour: "2-digit",
            minute: "2-digit",
            timeZoneName: "short",
          });
          link.appendChild(container);

          return link;
        },
        margin: {
          item: {
            horizontal: 10,
            vertical: 30,
          },
          axis: 30,
        },
        stack: true,
        orientation: "top",
        showCurrentTime: true,
        selectable: false,
        verticalScroll: true,
        moveable: true,
        zoomable: true,
        maxHeight: (() => {
          const headerHeight = parseInt(
            getComputedStyle(document.documentElement).getPropertyValue(
              "--header-height"
            )
          );
          return window.innerHeight - headerHeight;
        })(),
        start: new Date(currentDate.getTime() - 7 * 24 * 60 * 60 * 1000),
        end: new Date(currentDate.getTime()),
        cluster: {
          maxItems: 1,
          titleTemplate: "Double click to expand group",
          clusterCriteria: function (firstItem, secondItem) {
            // Only cluster periods without alerts
            if (
              firstItem.className === "alert-item" ||
              secondItem.className === "alert-item"
            ) {
              return false;
            }
            return firstItem.className === secondItem.className;
          },
        },
        rollingMode: {
          follow: false,
          offset: 0,
        },
        zoomMin: 6 * 60 * 60 * 1000,
        zoomMax: 365 * 24 * 60 * 60 * 1000,
        min: new Date(
          new Date(vmaData[0].datetime).getTime() - 30 * 24 * 60 * 60 * 1000
        ),
        max: new Date(
          currentDate.getFullYear(),
          currentDate.getMonth() + 1,
          currentDate.getDate()
        ),
      };

      // Populate latest update section
      const latestItem = vmaData[vmaData.length - 1];
      const updateEmoji = document.getElementById("update-emoji");
      const updateType = document.getElementById("update-type");
      const updateTime = document.getElementById("update-time");
      const latestUpdateLink = document.getElementById("latest-update-link");

      updateEmoji.innerHTML =
        latestItem.type === "quiet"
          ? `<span style="font-size: 48px;">${sleepingEmoji}</span>`
          : loudspeakerSvg.replace('fill="#000000"', 'width="48" height="48"');
      updateType.textContent = latestItem.type === "quiet" ? "Quiet" : "Alert";
      updateType.style.color =
        latestItem.type === "quiet" ? "#98a7c3" : "#e61f43";

      const date = new Date(latestItem.datetime);
      updateTime.textContent = date.toLocaleString("en-SE", {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        timeZoneName: "short",
      });

      const fileName = `${latestItem.datetime}_${latestItem.type}.json`;
      const githubUrl = `${REPO_URL}/${fileName}`;
      latestUpdateLink.href = githubUrl;

      // Create the Timeline
      var container = document.getElementById("timeline");
      var timeline = new vis.Timeline(container, items, options);

      const initialStart = new Date(
        new Date(currentDate).getTime() - 24 * 60 * 60 * 1000
      );
      const initialEnd = new Date(
        new Date(currentDate).getTime() + 60 * 60 * 1000
      );

      // Update maxHeight on window resize
      window.addEventListener("resize", function () {
        const headerHeight = parseInt(
          getComputedStyle(document.documentElement).getPropertyValue(
            "--header-height"
          )
        );
        timeline.setOptions({
          ...options,
          maxHeight: window.innerHeight - headerHeight,
          start: initialStart,
          end: initialEnd,
        });
      });

      // Scroll into view
      timeline.setWindow(initialStart, initialEnd);
    </script>
  </body>
</html>
